<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Station 1</title>
  <script type="text/javascript" src="../simpleGame.js"></script>
  <!-- ------------------- script game ------------------- -->
  <script type="text/javascript">
    var game;
    var background;
    var car_self;
    var ROAD_SPEED = 15;
    var cars_Obstacle;
    var NUM_MAKECAR = 5;
    var makecar;
    var makecar2;


    //ถนน
    function Road() {
      //background
      tRoad = new Sprite(game, "../img/bg.jpg", 800, 1440);
      tRoad.setSpeed(0, 0);
      //ตึง background ไว้
      tRoad.setDX(0);
      tRoad.setDY(ROAD_SPEED)
      tRoad.setPosition(400, 300);
      tRoad.maxSpeed = 18;
      tRoad.minSpeed = 15;

      tRoad.checkBounds = function () {
        if (this.y > 720) {
          this.setPosition(400, -120)
        } // end if
      }

      tRoad.checkKeys = function () {
        //used for testing ocean position
        if (keysDown[K_UP] && ROAD_SPEED <= tRoad.maxSpeed) {
          ROAD_SPEED += .5;
          tRoad.setDY(ROAD_SPEED)
        }
        if (keysDown[K_DOWN] && ROAD_SPEED >= tRoad.minSpeed) {
          ROAD_SPEED -= .5;
          tRoad.setDY(ROAD_SPEED)
        }
      } // end checkKeys

      return tRoad;
    }

    //รถเราเอง
    function CarSelf() {
      tCar = new Sprite(game, "../img/car-self.png", 75, 120);
      tCar.setPosition(350, 530);

      tCar.setSpeed(0);
      tCar.maxSpeed = 10;
      tCar.minSpeed = -3;

      tCar.checkKeys = function () {
        if (keysDown[K_UP]) {

        }
        else if (keysDown[K_DOWN]) {

        }
        else if (keysDown[K_LEFT]) {
          this.setSpeed(ROAD_SPEED);
          this.setMoveAngle(270);
        }
        else if (keysDown[K_RIGHT]) {
          this.setSpeed(ROAD_SPEED);
          this.setMoveAngle(90);
        } else {
          this.setSpeed(0);
        }

        // console.log('=', this.x, this.y)
        // tCar.setSpeed(this.speed);
      }

      tCar.checkGravity = function () {
        if (this.x > 750) {
          this.setPosition(750, this.y);
        } else if (this.x < 45) {
          this.setPosition(45, this.y);

        }
      }

      return tCar;
    }

    //รถอุปสรรค
    function Car_ofstacle() {
      const arrPosition = [45, 144, 243, 349.5, 448.5, 556.5, 655.5, 750];
      tCar = new Sprite(game, "../img/car_obstacle_red.png", 75, 120)


      // สร้างใหม่
      tCar.reset = function () {
        //setDX setDY ทำให้ Object Move มาจากด้านบน
        // ความเร็วเท่ากับ
        this.setDY((Math.random()*ROAD_SPEED)+5);
        this.setDX(0);

        // newX = เซฟใส่ตรงนี้ 

        /* ตัวอย่าง */
        newX = Math.floor(Math.random() * 8);


        arrPosition
        this.setPosition(arrPosition[newX], 50);
      }
      //ตกแมพ
      tCar.checkBounds = function () {

        if (this.y > game.height) {
          this.reset();
        }

      }

      // เมือ่เกิด object เกิด ทำให้มีตำแหน่ง
      tCar.reset();

      return tCar;
    }

    function makeCars_ofstacle() {
      makecar = new Array(NUM_MAKECAR);
      makecar2 = new Array(NUM_MAKECAR);

      for (i = 0; i < makecar.length; i++) {
        makecar[i] = new Car_ofstacle();
        makecar2[i] = new Car_ofstacle();
      } // end for
    } // end makeCar



    // init function
    function init() {
      //game 
      game = new Scene();

      //background
      background = new Road();

      //car_self
      car_self = new CarSelf();
      //cars_obstacle
      //! ทำให้มีหลายคันด้วย : สตางค์
      makeCars_ofstacle();
      // cars_Obstacle = new Car_ofstacle();

      game.start();
    } //end init 


    //update function
    function update() {
      game.clear();

      //handle
      car_self.checkKeys();
      car_self.checkGravity();
      background.checkKeys();
      for (var i = 0; i < makecar.length; i++) {
        makecar[i].checkBounds();
      }



      //update
      background.update();
      car_self.update();
      // cars_Obstacle.update();



      for (var i = 0; i < makecar.length; i++) {
        makecar[i].update();
        // if (makecar[i].y > game.height / 1.1) {
        //   for (var i = 0; i < makecar2.length; i++) {
        //     makecar2[i].update();
        //   }
        //   break;
        // }
      }
    }//end update

  </script>
</head>


<body onload="init()">

</body>

</html>